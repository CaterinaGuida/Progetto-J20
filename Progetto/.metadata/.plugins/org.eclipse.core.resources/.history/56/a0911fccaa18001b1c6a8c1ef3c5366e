/* CLASSE CHE ACCEDE AL DATABASE PER MEMORIZZARE L'ACQUISTO DI UN TITOLO DI VIAGGIO */

package dao;

import java.sql.*;
import model.*;
import java.text.SimpleDateFormat;

public class DaoPurchase {
	
	private DaoFactory Dao;
	private SimpleDateFormat sdf = new SimpleDateFormat("dd/MM/yyyy HH:mm");

	public DaoPurchase(DaoFactory Dao) {
		super();
		this.Dao = Dao;
	}
	
	public void addSingleTicket(SingleTicket titolo) {
		
		
		try {
			
			Connection con = Dao.getConnection();
			Statement st= con.createStatement();
			String query=String.format("insert into titoli(codice,tipo,purchaseDate) values('%s','singolo','%s')",titolo.getTicketCode(),sdf.format(titolo.getPurchaseDate()));
			st.executeUpdate(query);
			con.close();
			
		} catch (SQLException e) {
			
			e.printStackTrace();
		}
		
	}
public void addCumulativo(CumulativeTicket titolo) {
		
		
		try {
			
			Connection con = Dao.getConnection();
			Statement st= con.createStatement();
			String query=String.format("insert into titoli(codice,tipo,purchaseDate,numviaggi) values('%s','cumulativo','%s','%d')",titolo.getTicketCode(),sdf.format(titolo.getPurchaseDate()), titolo.getTripsNumber());
			st.executeUpdate(query);
			con.close();
			
		} catch (SQLException e) {
			
			e.printStackTrace();
		}
		
	}
	
	public void addAbbonamento(Pass titolo) {
		
		
		try {
			
			Connection con = Dao.getConnection();
			Statement st= con.createStatement();
			Statement st1= con.createStatement();
			String query=String.format("insert into titoli(codice,tipo,purchaseDate) values('%s','abbonamento','%s')",titolo.getTicketCode(),sdf.format(titolo.getPurchaseDate()));
			st.executeUpdate(query);
			String query1=String.format("insert into abbonamento(id,firstName,lastName,expirarionDate,duration) values('%s','%s','%s','%s','%s')",titolo.getTicketCode(),titolo.getFirstName(),titolo.getLastName(),sdf.format(titolo.getExpirationDate()),titolo.getDuration().toString());
			st1.executeUpdate(query1);
			con.close();
		} catch (SQLException e) {
			
			e.printStackTrace();
		}
		
	}

}
